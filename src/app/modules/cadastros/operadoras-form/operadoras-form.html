<div class="container mt-4">
  <h2>{{ isEditMode ? 'Editar Operadora' : 'Nova Operadora' }}</h2>
  <form [formGroup]="form" (ngSubmit)="save()">

    <mat-tab-group mat-align-tabs="start">
      <mat-tab label="Dados Gerais">
        <div class="row mt-3">
          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Registro ANS</mat-label>
              <input matInput formControlName="registroAns" required>
              <mat-error *ngIf="form.get('registroAns')?.hasError('required')">Registro ANS é obrigatório</mat-error>
              <mat-error *ngIf="form.get('registroAns')?.hasError('maxlength')">Máximo de 6 caracteres</mat-error>
            </mat-form-field>

            <mat-form-field class="w-100">
              <mat-label>CNPJ</mat-label>
              <input matInput formControlName="cnpj" mask="00.000.000/0000-00" required>
              <mat-error *ngIf="form.get('cnpj')?.hasError('required')">CNPJ é obrigatório</mat-error>
            </mat-form-field>

            <mat-form-field class="w-100">
              <mat-label>Razão Social</mat-label>
              <input matInput formControlName="razaoSocial" required>
              <mat-error *ngIf="form.get('razaoSocial')?.hasError('required')">Razão Social é obrigatória</mat-error>
            </mat-form-field>
          </div>

          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Nome Fantasia</mat-label>
              <input matInput formControlName="nomeFantasia">
            </mat-form-field>

            <mat-form-field class="w-100">
              <mat-label>Data Registro ANS</mat-label>
              <input matInput [matDatepicker]="picker" formControlName="dataRegistroAns">
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>

            <div class="mt-3">
              <mat-checkbox formControlName="ativo">Ativo</mat-checkbox>
            </div>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="Endereços">
        <div formArrayName="enderecos" class="mt-3">
          <div *ngFor="let enderecoGroup of enderecos.controls; let i = index" [formGroupName]="i">
            <mat-card class="mb-3">
              <mat-card-header>
                <mat-card-title>Endereço #{{ i + 1 }}</mat-card-title>
                <button mat-icon-button color="warn" (click)="removeEndereco(i)" *ngIf="enderecos.length > 1">
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-card-header>
              <mat-card-content>
                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field class="w-100">
                      <mat-label>Tipo</mat-label>
                      <input matInput formControlName="tipo" required>
                      <mat-error *ngIf="enderecoGroup.get('tipo')?.hasError('required')">Tipo é obrigatório</mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field class="w-100">
                      <mat-label>CEP</mat-label>
                      <input matInput formControlName="cep" mask="00000-000" required>
                      <mat-error *ngIf="enderecoGroup.get('cep')?.hasError('required')">CEP é obrigatório</mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field class="w-100">
                      <mat-label>País</mat-label>
                      <input matInput formControlName="pais" required>
                      <mat-error *ngIf="enderecoGroup.get('pais')?.hasError('required')">País é obrigatório</mat-error>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-8">
                    <mat-form-field class="w-100">
                      <mat-label>Logradouro</mat-label>
                      <input matInput formControlName="logradouro" required>
                      <mat-error *ngIf="enderecoGroup.get('logradouro')?.hasError('required')">Logradouro é obrigatório</mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field class="w-100">
                      <mat-label>Número</mat-label>
                      <input matInput formControlName="numero" required>
                      <mat-error *ngIf="enderecoGroup.get('numero')?.hasError('required')">Número é obrigatório</mat-error>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field class="w-100">
                      <mat-label>Complemento</mat-label>
                      <input matInput formControlName="complemento">
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field class="w-100">
                      <mat-label>Bairro</mat-label>
                      <input matInput formControlName="bairro" required>
                      <mat-error *ngIf="enderecoGroup.get('bairro')?.hasError('required')">Bairro é obrigatório</mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-2">
                    <mat-form-field class="w-100">
                      <mat-label>Cidade</mat-label>
                      <input matInput formControlName="cidade" required>
                      <mat-error *ngIf="enderecoGroup.get('cidade')?.hasError('required')">Cidade é obrigatória</mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-2">
                    <mat-form-field class="w-100">
                      <mat-label>UF</mat-label>
                      <input matInput formControlName="uf" required>
                      <mat-error *ngIf="enderecoGroup.get('uf')?.hasError('required')">UF é obrigatória</mat-error>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <mat-form-field class="w-100">
                      <mat-label>Latitude</mat-label>
                      <input matInput formControlName="latitude" type="number">
                    </mat-form-field>
                  </div>
                  <div class="col-md-6">
                    <mat-form-field class="w-100">
                      <mat-label>Longitude</mat-label>
                      <input matInput formControlName="longitude" type="number">
                    </mat-form-field>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
          <button mat-raised-button color="accent" (click)="addEndereco()">
            <mat-icon>add</mat-icon> Adicionar Endereço
          </button>
        </div>
      </mat-tab>

      <mat-tab label="Telefones">
        <div formArrayName="telefones" class="mt-3">
          <div *ngFor="let telefoneGroup of telefones.controls; let i = index" [formGroupName]="i">
            <mat-card class="mb-3">
              <mat-card-header>
                <mat-card-title>Telefone #{{ i + 1 }}</mat-card-title>
                <button mat-icon-button color="warn" (click)="removeTelefone(i)" *ngIf="telefones.length > 1">
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-card-header>
              <mat-card-content>
                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field class="w-100">
                      <mat-label>Tipo</mat-label>
                      <input matInput formControlName="tipo" required>
                      <mat-error *ngIf="telefoneGroup.get('tipo')?.hasError('required')">Tipo é obrigatório</mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-2">
                    <mat-form-field class="w-100">
                      <mat-label>DDD</mat-label>
                      <input matInput formControlName="ddd" mask="00" required>
                      <mat-error *ngIf="telefoneGroup.get('ddd')?.hasError('required')">DDD é obrigatório</mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field class="w-100">
                      <mat-label>Número</mat-label>
                      <input matInput formControlName="numero" mask="0000-0000||0 0000-0000" required>
                      <mat-error *ngIf="telefoneGroup.get('numero')?.hasError('required')">Número é obrigatório</mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-2">
                    <mat-form-field class="w-100">
                      <mat-label>Ramal</mat-label>
                      <input matInput formControlName="ramal">
                    </mat-form-field>
                  </div>
                </div>
                <div class="mt-3">
                  <mat-checkbox formControlName="whatsapp">WhatsApp</mat-checkbox>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
          <button mat-raised-button color="accent" (click)="addTelefone()">
            <mat-icon>add</mat-icon> Adicionar Telefone
          </button>
        </div>
      </mat-tab>

      <mat-tab label="E-mails">
        <div formArrayName="emails" class="mt-3">
          <div *ngFor="let emailGroup of emails.controls; let i = index" [formGroupName]="i">
            <mat-card class="mb-3">
              <mat-card-header>
                <mat-card-title>E-mail #{{ i + 1 }}</mat-card-title>
                <button mat-icon-button color="warn" (click)="removeEmail(i)" *ngIf="emails.length > 1">
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-card-header>
              <mat-card-content>
                <div class="row">
                  <div class="col-md-6">
                    <mat-form-field class="w-100">
                      <mat-label>Tipo</mat-label>
                      <input matInput formControlName="tipo" required>
                      <mat-error *ngIf="emailGroup.get('tipo')?.hasError('required')">Tipo é obrigatório</mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-6">
                    <mat-form-field class="w-100">
                      <mat-label>E-mail</mat-label>
                      <input matInput formControlName="email" type="email" required>
                      <mat-error *ngIf="emailGroup.get('email')?.hasError('required')">E-mail é obrigatório</mat-error>
                      <mat-error *ngIf="emailGroup.get('email')?.hasError('email')">E-mail inválido</mat-error>
                    </mat-form-field>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
          <button mat-raised-button color="accent" (click)="addEmail()">
            <mat-icon>add</mat-icon> Adicionar E-mail
          </button>
        </div>
      </mat-tab>
    </mat-tab-group>

    <!-- Ações -->
    <div class="d-flex justify-content-end mt-3">
      <button mat-stroked-button type="button" (click)="cancel()" class="me-2">Cancelar</button>
      <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">Salvar</button>
    </div>
  </form>
</div>